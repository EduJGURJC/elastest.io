--- 
layout: default 
title: Elastest Documentation - Advanced example 
active: documentation 
section-title: Documentation 
section-icon: mdi mdi-content-copy 
---
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/float-panel.js"></script>

<script type="text/javascript">
	/* Import docs theme css */
	$('head').append('<link rel="stylesheet" type="text/css" href="/css/theme_extra.css">');
	

	$( document).ready(function(){
		$('#menu-list').show();
	    $('li.subnav_drop').find('ul.subnav').hide();
	       $( ".subnav" ).find( "li:contains('Advanced example')" ).each(function(i,e){
		  var currentElement = $(e);
		  currentElement.parent().css({"display":"block","visibility":"visible"}); //css("background-color","blue");
		  currentElement.css({"display":"block","visibility":"visible"});
	       });
	    $('li.subnav_drop').click(function(i,e) {  
	      $('li.subnav_drop').not(this).find('ul.subnav').hide();
	      $(this).find('ul.subnav').toggle();
	    }); 

	    var minHeight = $('#float-panel').outerHeight() + 100;	
						$('#doc-container').css('min-height', minHeight+'px');
	});
	   
	$( ".wy-nav-content" ).find( "li:contains('Advanced example')" ).css('color','red');
 </script>

<div id="doc-container" class="container text-justify">
  <div class="holder range"> 
        <div id="float-panel" class="wy-grid-for-nav cell-xs-3 cell-md-3 cell-lg-2 float-panel" data-top="56">

          
          <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
            <div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
		<div id="site-menu-title">
			<h3 class="h5">Explore docs</h3>
			<hr class="divider hr-lg-left-0 bg-orange">    
		</div>
		<ul id="menu-list" class="current" hidden>
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Getting started</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../..">What is ElasTest?</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../try-elastest/">Try ElasTest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../your-first-test/">Your first test with ElasTest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../support/">Get support from ElasTest team</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Testing with ElasTest</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/unit/">Run unit tests</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/e2e-rest/">Run end2end tests</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/parameterized-tests/">Parameterized tests</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/environment-variables/">Environment variables</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/sut/">Software under Test</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Web Browsers</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/manual-browsers/">Launching Web Browsers on ElasTest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/e2e-browser/">Run en2end tests with Web Browsers</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/outside-testing/">Testing with Web Browsers from outside ElasTest</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../log-analyzer/">Log Analyzer</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../testlink/">TestLink with ElasTest</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Monitoring</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/">Monitoring</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/outside-elastest/">Monitoring outside Elastest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/custom/">Custom monitoring</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Jenkins</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../">Jenkins integration</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../try-jenkins/">Try jenkins</a>
        
    </li>


        
             

    <li class="toctree-l1 current">
        <a class="current" href="./">Advanced example</a>
        
         
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Deploying ElasTest</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../deploying/aws/">Amazon Web Services</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../deploying/ubuntu/">Ubuntu</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../releases/">Releases</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../experimental/">Experimental</a>
        
    </li>

</ul></li>
				
			
		</ul>
            </div>
            &nbsp;
          </nav>
        </div>

	<section class="section-sm-41">
		<div class="shell">
		    <div class="range range-xs-right">
		        <div class="cell-xs-10 cell-sm-8 cell-md-9 cell-lg-10 cell-xl-12 text-md-left cell-lg-push-1 offset-lg-top-0">
			  
				<div class="wy-nav-content">
				  <div class="rst-content">
				   
				    <div role="main">
				      <div class="section">
					
					  <div class="range range-xs-left">
<div class="cell-xs-10 cell-lg-6 text-md-left inset-md-right-80 cell-lg-push-1 offset-top-50 offset-lg-top-0">
<h2 id="content" class="h1">Advanced example</h2>
<div class="offset-top-30 offset-md-top-50">
</div>
</div>
</div>

<h4 class="holder-subtitle link-top">Pipeline Job Examples</h4>

<p>The installation of ElasTest, Jenkins and the collaboration between them, allows several configurations.</p>
<p>Bellow, you will find an example of pipeline where using the ElasTest plugin and implements severals configurations, a SUT is started and a test battery is executed on it.
To configure this option, ElasTest provides the connection info using <a href="../../testing/environment-variables">environment variables</a>. This example is included in the Jenkins instance provided by ElasTest. If you use your own Jenkins, you will have to configure it manually in the following way:</p>
<h5>WebApp</h5>

<p>This pipeline configures the ElasTes plugin, starts the SUT and clones the repository with the test to execute it.</p>
<pre><code>node{
    elastest(tss: ['EUS'], surefireReportsPattern: '**/target/surefire-reports/TEST-*.xml', monitoring: true) {
        stage ('Executing Test') {
            echo 'Print env variables'
            sh 'env'
            def sutImage = docker.image('elastest/demo-web-java-test-sut')
            echo 'Start SUT'
            sutImage.withRun(&quot;--name ${env.ET_SUT_CONTAINER_NAME}&quot;) { c -&gt;
                echo &quot;${c.id}&quot;
                def sutContainerName = env.ET_SUT_CONTAINER_NAME;
                def sutNetwork = getFirstNetwork(sutContainerName)
                def sutIp = containerIp(sutContainerName,network)
                sh 'docker run -e IP=' + sutIp + ' -e PORT=8080 --network=' + sutNetwork + ' elastest/etm-check-service-up'
                withEnv(['ET_SUT_HOST=' + sutIp]) {
                    echo 'Set up test environment'
                    mvnHome = tool 'M3.3.9'
                    echo 'Cloning repository'
                    git 'https://github.com/elastest/demo-projects'
                    echo 'Run test'
                    sh &quot;cd ./web-java-test/;'${mvnHome}/bin/mvn' -Dtest=WebAppTest test&quot;
                }
            }

        }        
    }
}

def getFirstNetwork(containerName) {
    echo &quot;Inside getFirstNetwork function&quot;
    network = sh (
        script: &quot;docker inspect &quot; + containerName + &quot; -f \&quot;{{json .NetworkSettings.Networks}}\&quot; | awk \&quot;{sub(/:.*/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/\\\&quot;/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/\\\&quot;/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/{/,\\\&quot;\\\&quot;)}1\&quot;&quot;,
        returnStdout: true
    ).trim()

    echo containerName+&quot; Network = &quot; + network;
    return network;
}

def containerIp(containerName, network) {
    echo &quot;Inside containerIp function&quot;
    containerIp = sh (
        script: &quot;docker inspect --format=\&quot;{{.NetworkSettings.Networks.&quot; + network + &quot;.IPAddress}}\&quot; &quot;+ containerName,
        returnStdout: true
    ).trim()

    echo containerName+&quot; IP = &quot; + containerIp;
    return containerIp;
}
</code></pre>

<p>The example above can be split into the following sections:</p>
<ul>
<li><strong>ElasTest plugin configuration</strong> : You can choose to send the logs of your build</li>
</ul>
<p></p>

<pre><code>node{
    elastest() {
        .......
    {
</code></pre>

<p></p>

<ul>
<li><strong>Sut configuration</strong> : The SUT must be started, passing the <code>${env.ET_SUT_CONTAINER_NAME}</code> env variable (provided by ElasTest) as name of the container. This will allow ElasTest to receive logs and metrics from the Sut.
<p></p></li>
</ul>
<pre><code>def sutImage = docker.image('elastest/demo-web-java-test-sut')
            echo 'Start SUT'
            sutImage.withRun(&quot;--name ${env.ET_SUT_CONTAINER_NAME}&quot;) { c -&gt;
</code></pre>

<p></p>

<ul>
<li><strong>Wait for Sut</strong> : You have to obtain the Sut network and ip and run check image (elastest/etm-check-service-up) provided by ElasTest to wait for the Sut to be ready to be used.
<p></p></li>
</ul>
<pre><code>def sutContainerName = env.ET_SUT_CONTAINER_NAME;
            def sutNetwork = getFirstNetwork(sutContainerName)
            def sutIp = containerIp(sutContainerName,network)
            sh 'docker run -e IP=' + sutIp + ' -e PORT=8080 --network=' + sutNetwork + ' elastest/etm-check-service-up'
</code></pre>

<p></p>

<ul>
<li><strong>Test Execution</strong> : Finally, the tests should be executed to verify that the SUT is working correctly. Remember that you have to configure the Sut ip as a environment variable or pass it as a maven property due to the browsers we have used need to know where is the SUT located.</li>
</ul>
<p></p>

<pre><code>....
withEnv(['ET_SUT_HOST=' + sutIp]) {
            echo 'Set up test environment'
            mvnHome = tool 'M3.3.9'
            echo 'Cloning repository'
            git 'https://github.com/elastest/demo-projects'
            echo 'Run test'
            sh &quot;cd ./web-java-test/;'${mvnHome}/bin/mvn' -Dtest=WebAppTest test&quot;
        }
....
</code></pre>

<div class="range range-xs-center warning-range">
  <div class="cell-xs-4 cell-lg-1 cell-lg-push-1" style="text-align: center;"><span class="icon mdi mdi-information-outline warning-span"></span></div>
  <div class="cell-xs-8 cell-lg-11 cell-lg-push-11 warning-text"><p><i>You can refresh your mind visiting our tutorial <a href="/docs/testing/e2e-rest">How implement a test</a>.</i></p></div>
</div>

<script src="//code.jquery.com/jquery-3.2.1.min.js"></script>

<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js"></script></p>
<script>
var galleries = $('div.docs-gallery');
for (var i = 1; i <= galleries.length; i++) {
    $().fancybox({
    selector : '[data-fancybox="gallery-' + i + '"]',
    infobar : true,
    arrows : false,
    loop: false,
    protect: true,
    transitionEffect: 'slide',
    buttons : [
        'close'
    ],
    clickOutside : 'close',
    clickSlide   : 'close',
  });
}
</script>
					
				      </div>
				    </div>
				    <footer>
<hr class="divider divider-100 divider-xs hr-lg-center-0 offset-xs-top-20 offset-sm-top-20 offset-md-top-20 offset-lg-top-20">
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../deploying/aws/" class="btn btn-xs btn-primary float-right" title="Amazon Web Services">Next &raquo;<span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../try-jenkins/" class="btn btn-xs btn-primary" title="Try jenkins"><span class="icon icon-circle-arrow-left"></span> &laquo; Prev</a>
      
    </div>
  


  
  
	  <a href="https://github.com/elastest/elastest.io-docs/blob/master/docs/jenkins/advanced-example.md" class="fa fa-github offset-xxs-top-30"> Edit Documentation on GitHub</a>
  
</footer>
			  	  
				  </div>
				</div>
			</div>
		    </div>
		</div>
	</section>

  </div>
</div>