--- 
layout: default 
title: Elastest Documentation - Native deployment 
active: documentation 
section-title: Documentation 
section-icon: mdi mdi-content-copy 
---
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/float-panel.js"></script>

<script type="text/javascript">
	/* Import docs theme css */
	$('head').append('<link rel="stylesheet" type="text/css" href="/css/theme_extra.css">');
	

	$( document).ready(function(){
	    $('li.subnav_drop').find('ul.subnav').hide();
	       $( ".subnav" ).find( "li:contains('Native deployment')" ).each(function(i,e){
		  var currentElement = $(e);
		  currentElement.parent().css({"display":"block","visibility":"visible"}); //css("background-color","blue");
		  currentElement.css({"display":"block","visibility":"visible"});
	       });
	    $('li.subnav_drop').click(function(i,e) {  
	      $('li.subnav_drop').not(this).find('ul.subnav').hide();
	      $(this).find('ul.subnav').toggle();
	    }); 

	    var minHeight = $('#float-panel').outerHeight() + 100;	
            $('#doc-container').css('min-height', minHeight+'px');
	});
	   
	$( ".wy-nav-content" ).find( "li:contains('Native deployment')" ).css('color','red');
 </script>

<div id="doc-container" class="container text-justify">
  <div class="holder range"> 
        <div id="float-panel" class="wy-grid-for-nav cell-xs-3 cell-md-3 cell-lg-2 float-panel" data-top="56">

          
          <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
            <div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
		<div id="site-menu-title">
			<h3 class="h5">Explore docs</h3>
			<hr class="divider hr-lg-left-0 bg-orange">    
		</div>
		<ul id="menu-list" class="current">
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Getting started</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../..">What is ElasTest?</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../try-elastest/">Try ElasTest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../your-first-test/">Your first test with ElasTest</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Testing with ElasTest</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/unit/">Run unit tests</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/e2e-rest/">Run end2end tests</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Web Browsers</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/manual-browsers/">Launching Web Browsers on ElasTest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/e2e-browser/">Run en2end tests with Web Browsers</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/outside-testing/">Testing with Web Browsers from outside ElasTest</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../log-analyzer/">Log Analyzer</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Monitoring</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/">Intro</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/dockerized/">Dockerized monitoring</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/deployed/">Deployed monitoring</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/custom/">Custom monitoring</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/gui/">Monitoring user interface</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../jenkins/">Jenkins integration</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Deploying ElasTest</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../cloudformation/">CloudFormation</a>
        
    </li>


        
             

    <li class="toctree-l1 current">
        <a class="current" href="./">Native deployment</a>
        
         
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
		</ul>
            </div>
            &nbsp;
          </nav>
        </div>

	<section class="section-sm-41">
		<div class="shell">
		    <div class="range range-xs-right">
		        <div class="cell-xs-10 cell-sm-8 cell-md-9 cell-lg-10 cell-xl-12 text-md-left cell-lg-push-1 offset-lg-top-0">
			  
				<div class="wy-nav-content">
				  <div class="rst-content">
				   
				    <div role="main">
				      <div class="section">
					
					  <div class="range range-xs-left">
<div class="cell-xs-10 cell-lg-6 text-md-left inset-md-right-80 cell-lg-push-1 offset-top-50 offset-lg-top-0">
<h2 id="content" class="h1">Deploying ElasTest from scratch</h2>
<div class="offset-top-30 offset-md-top-50">
</div>
</div>
</div>

<h4 class="holder-subtitle link-top">Introduction</h4>

<p>Through the following lines you will find a guide to deploy Elastest on a single machine (physical or virtual). So the same steps can be applied to a server on your data center or an instance on AWS, OpenStack, Azure or Google Cloud.</p>
<p>You only need remote or physical access to an <strong>Ubuntu 16.04</strong> interactive shell to run commands as a privilegiated user.</p>
<h4 class="holder-subtitle link-top">Accesing the instance</h4>

<p>Depends on your infraestructure the access will be different. Please, refer to your system administrator to know how to grant access to the console.</p>
<h4 class="holder-subtitle link-top">Swap space</h4>

<p>Elastest needs some swap space. If your server is physical, it probably has some space already. You can check by running:</p>
<pre><code class="bash">free -m
</code></pre>

<p>And you should see something like:</p>
<pre><code class="text">              total        used        free      shared  buff/cache   available
Mem:          15921        5059        5278        1130        5582        9337
Swap:           975           0         975
</code></pre>

<p>The line labeled as <em>swap</em> shows the swap space. When you have no swap space, it shows this:</p>
<pre><code class="text">              total        used        free      shared  buff/cache   available
Mem:          15921        5059        5278        1130        5582        9337
Swap:             0           0           0
</code></pre>

<p>If you're working on the cloud, you'll probably need to add some swap space. To do that follow this steps:</p>
<h6 class="small-subtitle">1) Creating a swap file</h6>

<pre><code class="bash">sudo fallocate -l 4G /swapfile
</code></pre>

<p>This command will create a 4G file in / called swapfile. You can check it by doing:</p>
<pre><code class="bash">ls -lh /swapfile
</code></pre>

<p>Now, set up the proper file permissions:</p>
<pre><code class="bash">sudo chmod 0600 /swapfile
</code></pre>

<h6 class="small-subtitle">2) Mark the file as swap space</h6>

<pre><code class="bash">sudo mkswap /swapfile
</code></pre>

<h6 class="small-subtitle">3) Activate the swap</h6>

<pre><code class="bash">sudo swapon /swapfile
</code></pre>

<h6 class="small-subtitle">4) Checking</h6>

<p>If you run the <em>free</em> command again you'll see the swap space available.</p>
<pre><code class="bash">free -m
</code></pre>

<h6 class="small-subtitle">5) Making changes permanent</h6>

<p>To make those changes permanent, add the following line to your <em>/etc/fstab</em> file:</p>
<pre><code class="text">/swapfile  none wap sw 0 0
</code></pre>

<h4 class="holder-subtitle link-top">The <i>vm.max_map_count</i> issue</h4>

<p>According to Elasticsearch docs, you need to set up <em>vm.max_map_count</em> to an upper value in production environments. Check <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html">here</a> if you need more information.</p>
<p>So, to increase that kernel parameter just do:</p>
<pre><code class="bash">sudo sysctl -w vm.max_map_count=262144
</code></pre>

<p>To make changes permanent,</p>
<pre><code class="bash">sudo echo vm.max_map_count=262144 &gt;&gt; /etc/sysctl.conf
</code></pre>

<h4 class="holder-subtitle link-top">Running Elastest on system boot</h4>

<p>There isn't an easy way to run Elastest with the system, but there's a few tips you can considerate.</p>
<h6 class="small-subtitle">Removing all volumes</h6>

<p>We recommend to remove all the volumes except the MySQL one, because is the one who maintain the test data.</p>
<p>To do so:</p>
<pre><code class="bash">for volume in $(docker volume ls | grep -v mysql | tail -n +2 | awk '{print $2}'); do docker volume rm $volume; done
</code></pre>

<h6 class="small-subtitle">Removing all containers</h6>

<p>To remove all the containers:</p>
<pre><code class="bash">docker rm -f $(docker ps -a -q)
</code></pre>

<h6 class="small-subtitle">Putting all the pieces together</h6>

<p>We provide a set of scripts to achive this:</p>
<h6 class="smaller-subtitle">1) Clean all containers and volumes (<code>/usr/local/bin/docker-evacuate</code>)</h6>

<pre><code class="bash">#!/bin/bash

# Delete all containers
docker rm -f $(docker ps -a -q)

for volume in $(docker volume ls | grep -v mysql | tail -n +2 | awk '{print $2}')
do
  docker volume rm $volume
done
</code></pre>

<p>Set execution permissions:</p>
<pre><code class="bash">chmod 0755 /usr/local/bin/docker-evacuate
</code></pre>

<h6 class="smaller-subtitle">2) Start Elastest (<code>/usr/local/bin/docker-elastest-up</code>)</h6>

<pre><code class="bash">#!/bin/bash
docker run -d -v /var/run/docker.sock:/var/run/docker.sock elastest/platform:latest start --server-address=YOU_IP_HERE --mode=MODE --pullcore
</code></pre>

<p>Remember to complete the <em>server-address</em> and <em>mode</em> parameters. You can run this command:</p>
<pre><code class="bash">docker run --rm -v /var/run/docker.sock:/var/run/docker.sock elastest/platform start --help
</code></pre>

<p>to get information.</p>
<p>Set execution permissions:</p>
<pre><code class="bash">chmod 0755 /usr/local/bin/docker-elastest-up
</code></pre>

<h6 class="smaller-subtitle">3) Systemd start script (<code>/etc/systemd/system/docker-elastest.service</code>)</h6>

<pre><code class="text">[Unit]
Description=Elastest Platform
After=docker.service
Requires=docker.service

[Service]
TimeoutStartSec=0
Restart=always
ExecStop=/usr/local/bin/docker-evacuate
ExecStart=/usr/local/bin/docker-elastest-up

[Install]
WantedBy=multi-user.target
</code></pre>

<p>Reload systemd daemon:</p>
<pre><code class="bash">sudo systemctl daemon-reload
</code></pre>

<p>Enable the service to start with the system</p>
<pre><code class="bash">sudo systemctl enable docker-elastest
</code></pre>
					
				      </div>
				    </div>
				    <footer>
<hr class="divider divider-100 divider-xs hr-lg-center-0 offset-xs-top-20 offset-sm-top-20 offset-md-top-20 offset-lg-top-20">
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../cloudformation/" class="btn btn-xs btn-primary" title="CloudFormation"><span class="icon icon-circle-arrow-left"></span> &laquo; Prev</a>
      
    </div>
  


  
  
	  <a href="https://github.com/elastest/elastest.io-docs/blob/master/docs/deploying/native.md" class="fa fa-github offset-xxs-top-30"> Edit Documentation on GitHub</a>
  
</footer>
			  	  
				  </div>
				</div>
			</div>
		    </div>
		</div>
	</section>

  </div>
</div>